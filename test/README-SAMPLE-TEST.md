# 🧪 샘플 테이블 마이그레이션 테스트

SQL2DB 마이그레이션 도구의 기능을 종합적으로 테스트하기 위한 샘플 테이블과 테스트 데이터입니다.

## 📋 개요

### 목적
- 실제 비즈니스 시나리오를 모사한 테스트 환경 제공
- 모든 마이그레이션 기능의 종합적인 검증
- 성능 및 안정성 테스트를 위한 충분한 데이터 볼륨

### 특징
- 🔗 **복잡한 외래키 관계**: 순환 참조 포함한 실제적인 테이블 관계
- 📊 **다양한 데이터 타입**: 문자열, 숫자, 날짜, DECIMAL, BIT 등
- 🎯 **실제적인 비즈니스 로직**: 주문, 고객, 상품, 사용자 관리 시스템
- 📈 **충분한 데이터 볼륨**: 각 테이블당 10-220개 레코드

## 🗂️ 테이블 구조

### 1. 핵심 엔티티 테이블

#### 👥 Users (사용자)
- **용도**: 시스템 사용자 정보 관리
- **특징**: 부서와 순환 참조 관계 (부서 관리자)
- **데이터**: 15명의 사용자 (다양한 상태)

#### 🏢 Departments (부서)
- **용도**: 조직 구조 관리
- **특징**: 사용자와 상호 참조 (manager_id)
- **데이터**: 8개 부서 (개발, 마케팅, 영업 등)

#### 🏪 Customers (고객)
- **용도**: 고객 정보 관리
- **특징**: 개인/법인 고객 구분
- **데이터**: 10개 고객 (개인 4명, 법인 6개)

### 2. 상품 관리 테이블

#### 📂 Categories (카테고리)
- **용도**: 계층적 상품 분류
- **특징**: 자기 참조 관계 (parent_category_id)
- **데이터**: 13개 카테고리 (5개 상위 + 8개 하위)

#### 📦 Products (상품)
- **용도**: 상품 정보 관리
- **특징**: 카테고리 및 등록자 참조
- **데이터**: 15개 상품 (전자제품, 의류, 가구 등)

### 3. 주문 관리 테이블

#### 🛒 Orders (주문)
- **용도**: 주문 헤더 정보
- **특징**: 고객 및 생성자 참조
- **데이터**: 10건의 주문 (다양한 상태)

#### 📋 Order_Items (주문상세)
- **용도**: 주문별 상품 상세
- **특징**: 주문 및 상품 참조, 계산 컬럼
- **데이터**: 19개 주문 상세 (할인율 포함)

### 4. 시스템 테이블

#### 📊 Activity_Logs (활동로그)
- **용도**: 사용자 활동 추적
- **특징**: 사용자 참조
- **데이터**: 10건의 활동 로그

## 🔗 외래키 관계

```
Users ←→ Departments (순환 참조)
  ↓
Products, Orders, Activity_Logs

Categories → Categories (자기 참조)
  ↓
Products

Customers → Orders → Order_Items → Products
```

## 📊 테스트 데이터 특징

### 실제적인 데이터
- **한국어 이름**: 실제 한국 이름 사용
- **실제 주소**: 한국의 실제 도시/구 정보
- **비즈니스 로직**: 실제 주문 프로세스 반영
- **날짜 분산**: 최근 30일간 분산된 주문 데이터

### 테스트 시나리오 고려
- **다양한 상태**: ACTIVE, PENDING, APPROVED, COMPLETED 등
- **조건부 필터링**: 날짜, 상태, 금액 기반 필터링
- **집계 및 조인**: 복잡한 JOIN 쿼리 테스트
- **NULL 값 처리**: 선택적 필드의 NULL 값 포함

## 🚀 사용 방법

### 1. 빠른 시작
```bash
# test 디렉토리에서 실행
cd test
run-sample-test.bat
```

### 2. 수동 실행

#### 1단계: 테이블 생성
```sql
-- SQL Server Management Studio 또는 sqlcmd에서 실행
sqlcmd -S "서버명" -d "데이터베이스명" -i "test/create-sample-tables.sql"
```

#### 2단계: 데이터 입력
```sql
sqlcmd -S "서버명" -d "데이터베이스명" -i "test/insert-sample-data.sql"
```

#### 3단계: 마이그레이션 테스트
```bash
# 설정 검증
node ../src/migrate-cli.js validate --query test/sample-migration-test.json

# DRY RUN 테스트
node ../src/migrate-cli.js migrate --query test/sample-migration-test.json --dry-run

# 실제 마이그레이션
node ../src/migrate-cli.js migrate --query test/sample-migration-test.json
```

## 🎯 테스트되는 기능들

### 1. 기본 마이그레이션 기능
- ✅ 테이블별 데이터 이관
- ✅ 조건부 데이터 필터링
- ✅ 다양한 데이터 타입 처리
- ✅ NULL 값 처리

### 2. 고급 기능
- ✅ 동적 변수 추출 (activeUserIds, deptBudgets)
- ✅ IN절 변수 치환
- ✅ 외래키 관계 처리
- ✅ 복잡한 JOIN 쿼리

### 3. 보안 및 권한
- ✅ isWritable 속성 검증
- ✅ 읽기 전용 DB 보호
- ✅ 타겟 DB 권한 체크

### 4. 시뮬레이션 및 검증
- ✅ DRY RUN 모드
- ✅ 쿼리문정의 파일 검증
- ✅ 연결 테스트

## 📈 성능 테스트

### 데이터 볼륨
- **총 레코드 수**: 약 300개
- **테이블 수**: 8개
- **외래키 관계**: 10개

### 예상 처리 시간
- **DRY RUN**: 2-5초
- **실제 마이그레이션**: 10-30초
- **설정 검증**: 1-2초

## 🛠️ 문제 해결

### 자주 발생하는 문제

#### 1. SQL 스크립트 실행 오류
```
해결책: SQL Server 연결 정보 확인
- 서버명, 데이터베이스명 확인
- 권한 확인 (CREATE, DROP, INSERT 권한 필요)
```

#### 2. 외래키 제약조건 오류
```
해결책: 순서대로 실행
1. create-sample-tables.sql (외래키 제약조건 포함)
2. insert-sample-data.sql (제약조건 임시 비활성화)
```

#### 3. isWritable 권한 오류
```
해결책: config/dbinfo.json 확인
- 타겟 DB의 isWritable: true 설정
- DB ID가 올바른지 확인
```

## 📁 파일 구조

```
test/
├── create-sample-tables.sql      # 테이블 생성 스크립트
├── insert-sample-data.sql        # 샘플 데이터 입력 스크립트
├── sample-migration-test.json    # 마이그레이션 쿼리문정의 파일 
├── run-sample-test.bat          # 통합 테스트 실행 스크립트
└── README-SAMPLE-TEST.md        # 이 문서
```

## 🎉 기대 결과

### 성공적인 테스트 완료 시
```
✅ 샘플 테이블 마이그레이션 테스트가 성공적으로 완료되었습니다!

📊 수행된 작업:
  1. ✅ 샘플 테이블 생성 (8개 테이블)
  2. ✅ 샘플 데이터 입력 (실제적인 테스트 데이터)
  3. ✅ 마이그레이션 설정 검증
  4. ✅ DRY RUN 시뮬레이션
  5. ✅ 실제 마이그레이션 실행

🎯 테스트된 기능:
  - 🔗 외래키 관계 처리
  - 📊 동적 변수 추출
  - 🎯 조건부 데이터 필터링
  - 🛡️ isWritable 권한 검증
  - 📋 복잡한 JOIN 쿼리
  - 🕒 날짜 기반 필터링
```

이 테스트를 통해 SQL2DB 마이그레이션 도구의 모든 기능이 올바르게 작동하는지 확인할 수 있습니다! 🚀 